{"ast":null,"code":"import _classCallCheck from \"/Users/georgina/Downloads/frontend/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/georgina/Downloads/frontend/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nimport { Component, ViewChild } from '@angular/core';\nimport { ItemService } from '../../services/item.service';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { MatSort } from '@angular/material/sort';\nimport { MachineContextService } from '../../services/machine-context.service';\n\nvar ItemsComponent = /*#__PURE__*/function () {\n  function ItemsComponent(itemService, contextService) {\n    _classCallCheck(this, ItemsComponent);\n\n    this.itemService = itemService;\n    this.contextService = contextService;\n    this.itemsBought = [];\n    this.columnsToDisplay = ['menu', 'product', 'price', 'id'];\n    this.displayElement = false;\n    this.credit = 0;\n    this.height = window.innerHeight - 260;\n  }\n\n  _createClass(ItemsComponent, [{\n    key: \"ngOnInit\",\n    value: function ngOnInit() {\n      this.retrieveItemList();\n      this.retrieveAvailableDenomsList();\n    }\n  }, {\n    key: \"ngOnDestroy\",\n    value: function ngOnDestroy() {\n      if (this.itemsSubscription) {\n        this.itemsSubscription.unsubscribe();\n      }\n\n      if (this.denomsSubscription) {\n        this.denomsSubscription.unsubscribe();\n      }\n\n      if (this.insertSubscription) {\n        this.insertSubscription.unsubscribe();\n      }\n\n      if (this.contextSubscription) {\n        this.contextSubscription.unsubscribe();\n      }\n\n      if (this.purchaseSubscription) {\n        this.purchaseSubscription.unsubscribe();\n      }\n\n      if (this.deleteSubscription) {\n        this.deleteSubscription.unsubscribe();\n      }\n\n      if (this.coinSubscription) {\n        this.coinSubscription.unsubscribe();\n      }\n\n      if (this.refundSubscription) {\n        this.refundSubscription.unsubscribe();\n      }\n    }\n  }, {\n    key: \"retrieveItemList\",\n    value: function retrieveItemList() {\n      var _this = this;\n\n      this.itemsSubscription = this.itemService.retrieveItems().subscribe(function (response) {\n        _this.items = response;\n        _this.itemsDataSource = new MatTableDataSource(_this.items); // this.itemsDataSource.sort = this.sort;\n      });\n    }\n  }, {\n    key: \"retrieveAvailableDenomsList\",\n    value: function retrieveAvailableDenomsList() {\n      var _this2 = this;\n\n      this.denomsSubscription = this.itemService.retrieveDenoms().subscribe(function (response) {\n        _this2.denoms = response;\n      });\n    }\n  }, {\n    key: \"retrieveLatestContext\",\n    value: function retrieveLatestContext() {\n      var _this3 = this;\n\n      this.contextSubscription = this.contextService.retrieveContexts().subscribe(function (response) {\n        if (response) {\n          _this3.context = response[response.length - 1];\n        }\n      });\n    }\n  }, {\n    key: \"addItem\",\n    value: function addItem(item) {\n      this.itemsBought.push(item);\n    }\n  }, {\n    key: \"getCount\",\n    value: function getCount(denom) {\n      return this.denoms.filter(function (i) {\n        return i === denom;\n      }).length;\n    }\n  }, {\n    key: \"onChange\",\n    value: function onChange(value) {\n      console.log(\"On change\" + value);\n      this.items = this.items.filter(function (x) {\n        return x.id != value;\n      });\n    }\n  }, {\n    key: \"getCountChange\",\n    value: function getCountChange(denom) {\n      return this.change.filter(function (i) {\n        return i === denom;\n      }).length;\n    }\n  }, {\n    key: \"purchase\",\n    value: function purchase() {\n      var _this4 = this;\n\n      this.purchaseSubscription = this.itemService.purchaseItem(this.itemsBought, this.credit).subscribe(function (response) {\n        if (response) {\n          console.log('purchase => ' + JSON.stringify(response));\n          _this4.change = response;\n\n          _this4.retrieveItemList();\n\n          _this4.retrieveAvailableDenomsList();\n\n          _this4.displayElement = true;\n          _this4.credit = 0;\n          _this4.itemsBought = [];\n          _this4.change = [];\n        }\n      });\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(item) {\n      var _this5 = this;\n\n      this.deleteSubscription = this.itemService.deleteItem(item.id).subscribe(function (response) {\n        if (response) {\n          _this5.context = response;\n\n          _this5.retrieveItemList();\n        }\n      });\n    }\n  }, {\n    key: \"insertCoin\",\n    value: function insertCoin(value) {\n      this.credit += value;\n    }\n  }]);\n\n  return ItemsComponent;\n}();\n\n__decorate([ViewChild(MatSort), __metadata(\"design:type\", MatSort)], ItemsComponent.prototype, \"sort\", void 0);\n\nItemsComponent = __decorate([Component({\n  selector: 'app-items',\n  templateUrl: './items.component.html',\n  styleUrls: ['./items.component.css']\n}), __metadata(\"design:paramtypes\", [ItemService, MachineContextService])], ItemsComponent);\nexport { ItemsComponent };","map":null,"metadata":{},"sourceType":"module"}